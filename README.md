# LinuxMonitoring-v2.0

Проект посвящен мониторингу и исследованию состояния системы в реальном времени.
В папке ```src``` содержатся отчёты о проделанной работе, а также написанные в ходе выполнения проекта скрипты и конфиги.

## Part 1. Генератор файлов
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/01" target="_blank">Ссылка на решение</a><br>
Написан bash-скрипт. Скрипт запускается с 6 параметрами. Пример запуска скрипта: \
`main.sh /opt/test 4 az 5 az.az 3kb` 

**Параметр 1** - это абсолютный путь. \
**Параметр 2** - количество вложенных папок. \
**Параметр 3** - список букв английского алфавита, используемый в названии папок (не более 7 знаков). \
**Параметр 4** - количество файлов в каждой созданной папке. \
**Параметр 5** - список букв английского алфавита, используемый в имени файла и расширении (не более 7 знаков для имени, не более 3 знаков для расширения). \
**Параметр 6** - размер файлов (в килобайтах, но не более 100).  

При запуске скрипта в указанном в параметре 1 месте, создаются папки и файлы с соответствующими именами и размером (имена и расширения сгенерированы из букв, используемых в параметре 3).  
Скрипт останавливает работу, если в файловой системе (в разделе /) останется 1 Гб свободного места.  
Записывает лог файл с данными по всем созданным папкам и файлам (полный путь, дата создания, размер для файлов).


## Part 2. Засорение файловой системы
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/02" target="_blank">Ссылка на решение</a><br>
bash-скрипт. Скрипт запускается с 3 параметрами. Пример запуска скрипта: \
`main.sh az az.az 3Mb`

**Параметр 1** - список букв английского алфавита, используемый в названии папок (не более 7 знаков). \
**Параметр 2** - список букв английского алфавита, используемый в имени файла и расширении (не более 7 знаков для имени, не более 3 знаков для расширения). \
**Параметр 3** - размер файла (в Мегабайтах, но не более 100).  

При запуске скрипта, в различных (любых, кроме путей содержащих **bin** или **sbin**) местах файловой системы, создаются папки с файлами.
Количество вложенных папок - до 100. Количество файлов в каждой папке - случайное число (для каждой папки своё).  
Скрипт останавливает работу, когда в файловой системе (в разделе /) останется 1 Гб свободного места.  
Свободное место в файловой системе определяется командой: `df -h /`  

Записывается лог файл с данными по всем созданным папкам и файлам (полный путь, дата создания, размер для файлов).  
В конце работы скрипта, на экран выводится время начало работы скрипта, время окончания и общее время его работы.

## Part 3. Очистка файловой системы
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/03" target="_blank">Ссылка на решение</a><br>
Написан bash-скрипт. Скрипт запускается с 1 параметром.
Скрипт умеет очищать систему от созданных в Part 2 папок и файлов 3 способами:

1. По лог файлу
2. По дате и времени создания
3. По маске имени (т.е. символы, нижнее подчёркивание и дата).  

Способ очистки задается при запуске скрипта, как параметр со значением 1, 2 или 3.

## Part 4. Генератор логов
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/04" target="_blank">Ссылка на решение</a><br>
Написан bash-скрипт, генерирующий 5 файлов логов **nginx** в *combined* формате.
Каждый лог должен содержать информацию за 1 день.

За день должно быть сгенерировано случайное число записей от 100 до 1000.
Для каждой записи случайным образом генерируются:

1. IP (любые корректные, т.е. не должно быть ip вида 999.111.777.777)
2. Коды ответа (200, 201, 400, 401, 403, 404, 500, 501, 502, 503)
3. Методы (GET, POST, PUT, PATCH, DELETE)
4. Даты (в рамках заданного дня лога, должны идти по увеличению)
5. URL запроса агента
6. Агенты (Mozilla, Google Chrome, Opera, Safari, Internet Explorer, Microsoft Edge, Crawler and bot, Library and net tool)

## Part 5. Мониторинг
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/05" target="_blank">Ссылка на решение</a><br>
Написан bash-скрипт для разбора логов **nginx** из Части 4 через **awk**.

Скрипт запускается с 1 параметром, который принимает значение 1, 2, 3 или 4.
В зависимости от значения параметра выводит:

1. Все записи, отсортированные по коду ответа
2. Все уникальные IP, встречающиеся в записях
3. Все запросы с ошибками (код ответа - 4хх или 5хх)
4. Все уникальные IP, которые встречаются среди ошибочных запросов

## Part 6. **GoAccess**
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/06" target="_blank">Ссылка на решение</a><br>
С помощью утилиты GoAccess получили ту же информацию, что и в Части 5.

## Part 7. **Prometheus** и **Grafana**
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/07" target="_blank">Ссылка на отчет</a><br>
##### Установлены и настроены **Prometheus** и **Grafana** на виртуальной машине
##### Настроен доступ к веб интерфейсам **Prometheus** и **Grafana** с локальной машины

##### Добавлено на дашборд **Grafana** отображение ЦПУ, доступной оперативной памяти, свободное место и кол-во операций ввода/вывода на жестком диске

##### Запущен bash-скрипт из Части 2
##### В Grafana видно изменение нагрузки жесткого диска (место на диске и операции чтения/записи)

##### Устанлена утилита **stress** и запущена команда `stress -c 2 -i 1 -m 1 --vm-bytes 32M -t 10s`
##### В Grafana видно изменение нагрузки жесткого диска, оперативной памяти и ЦПУ


## Part 8. Готовый дашборд
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/08" target="_blank">Ссылка на отчет</a><br>
##### Установлен готовый дашборд *Node Exporter Quickstart and Dashboard* с официального сайта **Grafana Labs**

##### Проведены те же тесты, что и в Части 7.

##### Запущена ещё одна виртуальная машина, находящаяся в одной сети с текущей
##### Запущен тест нагрузки сети с помощью утилиты **iperf3**

##### Посмотреть на нагрузку сетевого интерфейса

## Part 9. Дополнительно. Свой *node_exporter*
<a href="https://github.com/nekitze/LinuxMonitoring-v2.0/tree/main/src/09" target="_blank">Ссылка на решение и отчет</a><br>
Написан bash-скрипт который собирает информацию по базовым метрикам системы (ЦПУ, оперативная память, жесткий диск (объем)).<br>
Скрипт формирует html страничку по формату **Prometheus**, которую будет отдавать **nginx**. \
Сама страничка обновляется внутри bash-скрипта каждые 5 секунд.

##### Настроен конфигурационный файл **Prometheus**, чтобы он собирал информацию с созданной странички.

##### Проведены те же тесты, что и в Части 7.
